---
sudo: required
services:
  - docker

branches:
  only:
    - master

env:
  global:
    # DOCKER_EMAIL
    - secure: "h2lmC1Twfg5aKj9SaqjfqRwkGhzc/tk9Y3zD3sWu93Y+SsVV9F+X3Hqd5Fnwk+IIWBcCHr9yqgyimUrf2+KitbYYP3HlEUVccwBJW5t9FpK+EYwDImz5hitO2uCSGudseTDPu/husgwAvyltfoCGDwMoX0zzL3+VBlZbi9ufZ7MEb/rkUwEoznocF/w4HWKqskcwpWoAoLItgc+GfPL+xYF4pMppGosuUg040/29luqRtqYsaMf/4Ai8CzaliAEksSnOOB4fPtAnAuaXcKH9g1d2laJ47yUWhzObfbNy8oVOoQWBEwMdiZC2NDfhF2DErU5+voZTx+kRlb4OI3DH7Qhd/AtUEqbrEV+fTBLz8X6JJH2bv5jZysKVviC2+kkQCSeYOwljHAwBiriqTi6saapuBWYLpJtFdASZrw8Cw38jj3bgl1xrMrws0i5vldESJx1wvj64YgHqIYHH2qKzingzOTAOWu9VYaHZVVnRXxQYI24hi0Hs7aaJkB1Yc8lMdB9Y9tvevZSgSOKbR4LOXY2K9MYeULwoefIpe1s/LpWJYDR1vyru6O6Wjud3SqvIcntHiLfSXmvrxwdFOJl6PDydtrSxvW2lzikWQVR8/EEf7VnJOT1f7uFu1dH3w0ydxCowNut7Q8NDgjxbQQMn7b3dgv2CEDdnqtBdfr94LkE="
    # DOCKER_USER
    - secure: "GyLALioU32+BXW98RO/Ab9D4/86OPb5qsAYCpJUuVeMuiJbp4QeTu/W7L4hUrpvaZ0vTv4k9xCbRvhKg3WkcqzR8qqw85cQQ2GcfSfs2caVKmu8Wu/8sQytweEqIhIJ7nxyJdZzvM0xlosPLqGjGOhTn3wsAnm8AJcPuTWG8wEeJjMXp1KGA4cnN4ViYPCN3jnuXy7aGjICb1jgmY2uNLNx5EQ++9wWNa9O4is48VE7ieHVAzY19aoP/aVfGKTTUf63blmTlqypUAzhikAW68tHZaZDqiYu2UnlDQod42gEpn/16pdQPzW4qrinJ8h5w7qTm6HAtfSMHg1vFI0JFS8x3MIGDQHHHIX6CkMqpST0/4Dx1IJlggOrdr6NXiY1Z/wy9b+FcnfCwpUqu13raEtnU1f40bOzsCMRKPrgOe4OUKMWpr4wOzFAe/s9HOOl2IOumUAsdRJB/5bW4jcDSOEijIig9l1937yNaJYlWSrYvo2elJ/IgROMNwpqgviwLqJqDeJJaafkyPTlKntfhdIocYvbtgw/BDnL45udUznJUijQpFHW3YYU5PCGLMjnykwHHE/DBhrEG/gEQIQMSQMPRUeW6Ux3jtMFsVVU3eamCXhnKaopIzpi3f/Yl2nwcivE3bh1fHA1yzCl2sFufJ/8VdWfuwUPtoGwMUgN3jl4="
    # DOCKER_PASS
    - secure: "RL2nikOzanOA4Y4DAeEurJBYwRto/SumvqT7/M44r/09Mi+lo2fs6/fVuzaiwQWTUNa4735HvDOou5J1XTushE8RcYj1ifIyLTNuReuhX3LxoaxbCk3+o/9oHtmpAEKa2p2aSGcwdlCKr6LdwqJTVqin+VhYIpL3rNCNksX72kBemHB4y89g7BBYyuMSflY+1aZwgHO1NyvV5Sjx2+II1D/ij3fPcu+awhU/AhR2ouO4UpT0UHQ3GrLRzSbOAE4hZbCcxd0Cj35B4iRTLgJDBbxKzpV3XUf8klsEWBXsMFsOgFKmxNSJiscdaijMS4nBsRjZArc89MU5a1NvTbxokZD50BxakoryZsSoazvtpYnH99mDJ0KN9HauYXaVB9M1BfmxISqMicdyu5ET7faB1eJ4qIJCyWvo0vQx7apZi0N+dykeu6MRKVJapwqT8UlW2U+hGMntXmCq2RYaKBkAVOtc7fTBvArA2V84saF0d22NKioiXAemXMIvw2ceQ9o3t4iXwnIwBJCE4oCktzhLEDocfidh02CpdGv0RMZe4JDlwVNj/y3scc5OKIEhF9nikVgusqNYKoVYv0XBE+SBf9EHSW87iLS4SNenM3wGWmgmkMMMDtf4v7cmdYmY3zyljm2VGKtAzqErCfyZ/G9PnBCzHcHd7dSwxFwrWoJ2rMA="
    - DOCKER_REPO=spreadspace/onionbalance

script:
  ### build the new images
  - docker build -t $DOCKER_REPO:$TRAVIS_BRANCH-$TRAVIS_BUILD_NUMBER .

after_success:
  - >-
    if [ "${TRAVIS_BRANCH}" = master ]; then
      DOCKER_TAG="latest"
    else
      DOCKER_TAG="${TRAVIS_BRANCH}"
    fi
  - docker tag $DOCKER_REPO:$TRAVIS_BRANCH-$TRAVIS_BUILD_NUMBER $DOCKER_REPO:$DOCKER_TAG
  ### push to docker-hub
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - docker push $DOCKER_REPO:$TRAVIS_BRANCH-$TRAVIS_BUILD_NUMBER
  - docker push $DOCKER_REPO:$DOCKER_TAG
